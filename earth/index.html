<!DOCTYPE html>
<html>
  <head>
    <meta charset=utf-8 />
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no' />
    <meta name='apple-mobile-web-app-status-bar-style' content='black' />
    <meta name='apple-mobile-web-app-capable' content='yes' />
    <title></title>
    <link   href='bootstrap.css' rel='stylesheet'>
<!-- 	<link href='../css/source-sans-pro/stylesheet.css' rel='stylesheet' />
	<link href='../css/chunkfive/stylesheet.css' rel='stylesheet' />
 -->
 <link href='site.css' rel='stylesheet' />
<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
 </head>
  <body>
 <div class="container">
  <div class="row-fluid" >
  <div class="navbar navbar-fixed-top">
    <ul class="pager">
    <li class="previous"><a href="#" id='prev'>&larr; Older</a></li>
    <li class="next"><a href="#" id='next'>Newer &rarr;</a></li>
  </ul>
</div>
</div>
   <div class="row-fluid" >
<div class="span12"></div>
</div>
    <div class="row-fluid" >
        <div class="span12" id='images'>

</div>
  </div>
    </div>

   <script type="text/javascript">
function clearStories(){
   $("#images").empty();
}
function getNasaStories($next) {
    var $offset = parseInt($next)*100


    $.getJSON("https://api.scraperwiki.com/api/1.0/datastore/sqlite?format=jsondict&name=nasa&query=select%20article_url%2C%20article_title%2C%20article_date%2C%20instrument_title%2C%20article_image%2C%20image_caption%20%2C%20credit%2C%20article_contents%20from%20%60nasa_images%60%20limit%20100%20offset%20" + $offset + "&callback=?", function (data) {
        $.each(data, function (i, item) {
            $("#images").append("<div class='row-fluid story'><div class='span6'><img src='" + item.article_image +

              //+ "data:image/png;base64," + item.image_64 + "' 

              "' height='100%' /></div><div class='span6'><a href='" + item.article_url + "'><h3>" + item.article_title + "</h3></a><p>" + item.article_contents + "</p>"
              + "<p><span class='span6  date'><strong>" + item.article_date
             + "</strong></span><span class='span6 date'>" + item.instrument_title 
             + "</span></p><div class='row-fluid'><span class='span12'><em>"  
             + item.credit + "</em></span></div></div>"
            );
        });

    });
}
function buildPage($index,$next) {
    $('#next').attr('href', '#' + $next);
    $('#prev').attr('href', '#' + $index);

    getNasaStories($next);
    window.location.hash = '#' + $next;
}

 $(document).ready(function () {
   var $index = window.location.hash;
    if($index  === "#0" || $index  === "#" ||  $index  === "") {
          var $index = '0';
          buildPage(0,$index);
     } else {
          var $index = $index.replace('#','');
          buildPage(parseInt($index-1),$index);
     }

    
});

$('#next').bind('click', function () {
    clearStories();
    var $index = window.location.hash.replace('#','');
    var $next = parseInt($index)+1;
    buildPage($index,$next);
    });
$('#prev').bind('click', function () {
    clearStories();
    var $index = window.location.hash.replace('#','');
    if($index  === "#0" || $index  === "#" ||  $index  === "") {
        var $next = '0';
         buildPage(0,$index);
    } else {
    var $next = parseInt($index)-1;
    buildPage($next,$index);

    }
    
    });

  </script>
  </body>
</html>